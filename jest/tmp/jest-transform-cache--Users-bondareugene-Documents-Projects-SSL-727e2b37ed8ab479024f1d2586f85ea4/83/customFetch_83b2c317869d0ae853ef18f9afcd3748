/* istanbul ignore next */'use strict';Object.defineProperty(exports, "__esModule", { value: true });var _extends = Object.assign || function (target) {for (var i = 1; i < arguments.length; i++) {var source = arguments[i];for (var key in source) {if (Object.prototype.hasOwnProperty.call(source, key)) {target[key] = source[key];}}}return target;};exports.


































































































registerResponseMiddleware = registerResponseMiddleware;var /* istanbul ignore next */_SessionUserActions = require('../Stores/SessionUser/SessionUserActions'); /* istanbul ignore next */var _SessionUserActions2 = _interopRequireDefault(_SessionUserActions);var /* istanbul ignore next */_NotificationActions = require('../Stores/Notification/NotificationActions'); /* istanbul ignore next */function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * @param {string} url
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * @param {Object} requestOptions
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * @param {{isJson?: boolean, isHandlingUnauthorized?: boolean}} options
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       * @return {Promise.<Response|{}>}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       */function customFetch(url) {/* istanbul ignore next */var requestOptions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {}; /* istanbul ignore next */var options = arguments[2];var defaultOptions = { isResponseJson: true, isHandlingUnauthorized: true }; /* istanbul ignore next */var _defaultOptions$optio = _extends({}, defaultOptions, options),isResponseJson = _defaultOptions$optio.isResponseJson,isHandlingUnauthorized = _defaultOptions$optio.isHandlingUnauthorized;var optionsWithCustoms = Object.assign({}, commonRequestOptions, requestOptions);var responseMiddlewares = /* istanbul ignore next */[isHandlingUnauthorized && handleUnauthorized].concat(customMiddlewares, [isResponseJson && function (response) /* istanbul ignore next */{return response.json();}]);var responseFailureMiddlewares = [//TODO think about checking if Content-Type: application/json is there or not
    isResponseJson && function (response) {if (response.bodyUsed) {return Promise.reject({}); //since body was already used, we don't have it - let's return empty object
        }return response.json().then(function (json) /* istanbul ignore next */{return Promise.reject(json);});}];var fetchResult = fetch(url, optionsWithCustoms);var responseWithSuccessMiddlewares = responseMiddlewares.reduce(function (currentResponse, currentMiddleware) {if (currentMiddleware instanceof Function) {return currentResponse.then(currentMiddleware);}return currentResponse;}, fetchResult);var responseWithSuccessAndFailureMiddleware = responseFailureMiddlewares.reduce(function (currentResponse, currentMiddleware) {if (currentMiddleware instanceof Function) {return currentResponse.catch(currentMiddleware);}return currentResponse;}, responseWithSuccessMiddlewares);return responseWithSuccessAndFailureMiddleware;} /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             @name Response~json
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             @function
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             @return {Promise.<{}>}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             **/ /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * @param {Response} [response]
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  * @return {Promise.<Response, string>}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  */function handleUnauthorized(response) {if (response.status === 401 && isResponseJson(response)) {response.json().then(function (json) /* istanbul ignore next */{return (/* istanbul ignore next */_SessionUserActions2.default.setUnauthorized(json.error));});return Promise.reject(response);}if (response.status === 401) {/* istanbul ignore next */_SessionUserActions2.default.setUnauthorized('unknown');return Promise.reject(response);}if (response.status === 403) {/* istanbul ignore next */_NotificationActions.NotificationActions.createForbiddenAccessNotification();return Promise.reject(response);}return Promise.resolve(response);}function isResponseJson(response) {return response.headers.get('Content-Type').includes('application/json');}var commonRequestOptions = { credentials: 'same-origin' }; /* istanbul ignore next */exports.default = customFetch; /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * @callback registerResponseMiddleware~middleware
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * @param {Response} [middleware]
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * @return {Promise.<Response, string>}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                */ /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    * @type {registerResponseMiddleware~middleware[]}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    */var customMiddlewares = []; /**
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   * @param {registerResponseMiddleware~middleware} middleware
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   */function registerResponseMiddleware(middleware) {customMiddlewares.push(middleware);}